{% extends 'matching/base.html' %}

{% load static %}
{% block style %}
  <link rel="stylesheet" type="text/css" href="{% static 'matching/chat.css' %}">
{% endblock %}

{% block content %}


{% if user.pk == post.user.pk %}
  {% if not post.tutor %}
  <a href="{% url 'matching:close_post' post.pk %}" class="btn btn-info btn-lg">모집종료</a>
  {% else %}
  <a href="{% url 'matching:close_post' post.pk %}" class="btn btn-info btn-lg disabled">모집종료</a>
  {% endif %}
{% endif %}

  {% if post.tutor is null %}
    <form action="{% url 'matching:set_tutor' postpk=post.pk userpk=user.pk  %}"  method="POST">
      {% csrf_token %}
      <button class="set_tutor" type="submit">튜터링 시작</button>
    </form>
  {% endif %}
  <hr style="border-top:2px solid #bbb;">



<div class="chat">
  <div class="title">
    {{ post.title }}
  </div>

  <div class="mesgs">
    <div class="msg_history">

      {% for comment in comment_list %}
      {% if comment.post.tutor %}
        {% if comment.post.tutor.pk == comment.user.pk %}
        <div class="incoming_msg">
          <!--<div class="incoming_msg_img"> <img src="" alt=""> </div>-->
          <div class="received_msg">
            <p class="received_name">{{comment.user.profile.nickname}}</p>
            <div class="received_with_msg">
              <p>{{ comment.content }}</p>
              <span class="received_time_date"> {{ comment.pub_date|date:"P"}}   | {{ comment.pub_date|date:"m.d"}} </span>
            </div>
          </div>
        </div>
        {% endif %}
      {% endif %}
      {% if comment.post.user %}
        {% if comment.post.user.pk == comment.user.pk %}
        <div class="outgoing_msg">
          <div class="sent_msg">
            <p>{{ comment.content }}</p>
            <span class="sent_time_date"> {{ comment.pub_date|date:"P"}}    |  {{ comment.pub_date|date:"m.d"}} </span> </div>
        </div>
        {% endif %}
      {% endif %}
      {% endfor %}

    </div>
    <div class="type_msg">
      <div class="input_msg_write">
        <input type="text" class="write_msg" placeholder="Type a message" />
        <button class="msg_send_btn" type="button"><i class="fa fa-paper-plane-o" aria-hidden="true"></i></button>
      </div>
    </div>
  </div>
</div>

{% endblock %}
